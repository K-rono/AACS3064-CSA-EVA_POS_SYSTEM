.MODEL SMALL
.STACK 100
.DATA
    HORIZONTAL_LINE DB 20 DUP('=')
    LOGO DB "LOGO EVA$"
    MAIN_MENU_STR DB "SELECT ONE"

    PASSWORD db "admin$"
    PASSWORD_IN db 10 dup('$')
    DELETE db 8,' ',8,'$'
    LOGIN_STR db "Enter password:$"
    PASSWORD_INCORRECT_STR db "PASSWORD INCORRECT$"
.CODE
MAIN PROC
    MOV AX,@DATA
    MOV DS,AX

    CALL MAIN MENU


    MOV AX,4C00H
    INT 21H
MAIN ENDP

;DISPLAY MAIN MENU
MAIN_MENU PROC

    CALL PRINT_HORIZONTAL_LINE
    ;PRINT LOGO
    MOV AH,09H
    LEA DX, LOGO
    INT 21H
    CALL PRINT_HORIZONTAL_LINE



    RET
MAIN_MENU ENDP

;LOGIN PROCEDURE
LOGIN PROC
    RELOGIN:
    MOV AH,09H
    LEA DX,LOGIN_STR    ;PRINT LOGIN STRING
    INT 21H

    MOV SI,0 ;INITIAL INDEX FOR 'PASSWORD_IN'

    ENTER_PASSWORD:
        MOV AH,07H  ;READ CHAR
        INT 21H

        CMP AL,0DH ;CARRIAGE RETURN KEY
        JE ENTER_PASSWORD_FINISH

        CMP AL,08H ;BACKSPACE 
        JE ENTER_PASSWORD_BACKSPACE

        CMP SI,5    ;  EXCEED MAX INPUT
        JE ENTER_PASSWORD ;IGNORE INPUT

        MOV PASSWORD_IN[SI],AL ;STORE INPUT

        MOV AH, 02H	;PRINT * TO HIDE PASSWORD 
		MOV DL, "*" 
		INT 21H

        INC SI

        JMP ENTER_PASSWORD ;LOOP BACK
    
    ENTER_PASSWORD_BACKSPACE:
        CMP SI, 0			;IF NEVER INPUT BEFORE
		JE  ENTER_PASSWORD	;IGNORE BACKSPACE INPUT
	
		MOV AH,09H	
		LEA DX,DELETE
		INT 21H
		
		DEC SI
		MOV PASSWORD_IN[SI], "$"
        JMP ENTER_PASSWORD

    ;PRINT INCORRECT PASSWORD STRING
    PASSWORD_INCORRECT:
            CALL NEWLINE
            MOV AH,09H
            LEA DX,PASSWORD_INCORRECT_STR
            INT 21H
            CALL NEWLINE
            CALL NEWLINE
            JMP RELOGIN ;ENTER PASSWORD AGAIN

    ENTER_PASSWORD_FINISH:
        LEA SI,PASSWORD
        LEA DI,PASSWORD_IN

        COMPARE_PASSWORD:
            MOV AL,[SI]
            MOV BL,[DI]
            CMP AL,BL
            JNE PASSWORD_INCORRECT

            CMP BL,'$'
            JMP RETURN

            INC SI
            INC DI

            JMP COMPARE_PASSWORD

RETURN:
    RET

LOGIN ENDP

NEWLINE PROC
        MOV AH,02H
        MOV dl,0AH
        INT 21H
        MOV DL,13
        INT 21H
        RET
NEWLINE ENDP

;PRINT HORIZONTAL LINE IN MENUS OR REPORTS
PRINT_HORIZONTAL_LINE PROC
    MOV AH,09H
    LEA DX,HORIZONTAL_LINE
    INT 21H
    RET
PRINT_HORIZONTAL_LINE ENDP
    END MAIN